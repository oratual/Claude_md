#!/bin/bash
# ðŸ” Opus Model Detector - Vigila cambio de modelo y crea nueva consola

echo "ðŸ” OPUS DETECTOR STARTING - Model monitoring active"

while true; do
    sleep 900  # 15 minutos
    
    # Detectar si cambiÃ³ a Sonnet
    if pgrep -f "sonnet" > /dev/null || [ -f /tmp/model_changed_to_sonnet ]; then
        echo "âš ï¸  $(date): Detected model change from Opus! Attempting new console..."
        
        # Crear nueva instancia para intentar recuperar Opus
        echo "ðŸ”„ Creating new Claude instance to check for Opus availability..."
        
        # Notificar el cambio
        echo "MODEL_CHANGE_DETECTED=$(date)" >> /tmp/night_status.log
        
        # Crear seÃ±al para que scripts principales sepan del cambio
        touch /tmp/opus_lost_trying_recovery
        
        # Intentar abrir nueva consola (si estÃ¡ en Windows)
        if command -v cmd.exe > /dev/null; then
            cmd.exe /c "start cmd /k echo Checking for Opus availability..."
        fi
        
        echo "ðŸ”„ New console attempt completed, continuing monitoring..."
    fi
    
    echo "âœ… $(date): Model check completed, Opus still active" >> /tmp/opus_monitor.log
done